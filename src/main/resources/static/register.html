<!doctype html>
<html>
    <head>
	<meta charset="utf-8" />
        <title>Regisztráció - Keresztyén társkereső</title>

        <link href="https://fonts.googleapis.com/css?family=Cinzel|Lato&amp;subset=latin-ext" rel="stylesheet">

        <style>
            body {
                background: rgb(137, 57, 94);
                font-family: Lato;
            }

            form {
                background: #fff;
                box-shadow: 0 0 1000px hsl(332, 41%, 18%);

                border-radius: .5em;

                padding: 2em;

                position: fixed;

                top: 50%;
                left: 50%;

                max-height: 90%;
                overflow-y: auto;

                transform: translate(-50%, -50%);
                
                text-align: center;
            }

            h1 {
                margin: 0;
                font-family: Cinzel;
                text-align: center;
            }

            label {
                display: block;
                margin: 1em;
                text-align: left;
            }

            label input, label textarea, label select {
                background: #eee;
                border-radius: 1em;
                border: 0;
                padding: .5em 1em;
                margin-top: .5em;
                width: 100%;
                box-sizing: border-box;
            }

            input {
                display: block;
                font: inherit;
            }

            input[type=submit] {
                margin: 2em auto 1em auto;
                -webkit-appearance: none;
                border: 0;
                cursor: pointer;
                padding: .5em;
                border-radius: .5em;
            }

            input:focus {
                outline: none;
            }
        </style>
        
        <script>
            window.addEventListener('load', function () {
                document.getElementById('form').addEventListener('submit', sendRegister);
            });
            
            function sendRegister(e) {
                e.preventDefault();
                
                var elements = this.elements;
                
                var reader = new FileReader();
                reader.readAsDataURL(elements['picture'].files[0]);
                reader.onload = function () {
                    var obj = {
                        username: elements['username'].value,
                        birth: elements['birth'].value,
                        email: elements['email'].value,
                        password: elements['password'].value,
                        picture: reader.result,
                        felekezet: elements['felekezet'].value,
                        where: elements['where'].value,
                        sex: elements['sex'].value,
                        about: elements['about'].value
                    };

                    var request = new XMLHttpRequest();
                    request.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            console.log(this.responseText);
                            var data = JSON.parse(this.responseText);
                            document.cookie = 'userid=' + data.id;
                            document.cookie = 'username=' + elements['username'];
                            document.cookie = 'picture=' + reader.result;
                            //document.location = 'browse.html';
                        }
                    };
                    request.open("POST", "/api/user/register");
                    request.setRequestHeader("Content-type", "application/json");
                    request.send(JSON.stringify(obj));
                }
            }
        </script>
    </head>
    <body>
        <form id='form'>
            <h1>Regisztráció</h1>
                <label>
                    Név
                    <input name="username">
                </label>
                <label>
                    Életkor
                    <input type="number" name="birth">
                </label>
                <label>
                    E-mail
                    <input type="email" name="email">
                </label>
                <label>
                    Jelszó
                    <input type="password" name="password">
                </label>
                <label>
                    Kép
                    <input type="file" name="picture">
                </label>
                <label>
                    Felkezet
                    <input name="felekezet">
                </label>
                <label>
                    Származás
                    <input name="where">
                </label>
                <label>
                    Nem
                    <select name="sex">
                        <option value="ferfi">Férfi</option>
                        <option value="no">Nő</option>
                    </select>
                </label>
                <label>
                    Bemutatkozás
                    <textarea name="about"></textarea>
                </label>
            <input type="submit" value="Ámen">
        </form>
    </body>
</html>